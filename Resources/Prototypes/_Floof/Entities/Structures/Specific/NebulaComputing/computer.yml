- type: entity
  id: ComputerProgrammableBase
  parent: BaseStructureDynamic
  name: programmable computer
  description: A peak of technology.
  abstract: true
  components:
  # Visual
  - type: Sprite
    sprite: _Floof/Objects/Structures/NebulaComputing/computer.rsi
    layers:
    - state: base
    - state: working
      shader: unshaded
      map: [ working ]
    - state: printing
      shader: unshaded
      map: [ printing ]
  - type: Appearance
  - type: GenericVisualizer
    visuals:
      enum.PowerDeviceVisuals.Powered:
        working:
          True: { visible: true }
          False: { visible: false }
      enum.ProgrammableComputerVisuals.IsPrinting:
        printing:
          True: { visible: true }
          False: { visible: false }
  - type: InteractionOutline
  # Slots
  - type: ContainerContainer
    containers:
      cpu: !type:Container
      memory: !type:Container
      storage: !type:Container
  # UI
  # TODO reset RAM/PC on power loss
  - type: Clickable
  - type: ActivatableUI
    key: enum.ProgrammableComputerUiKey.Key
  - type: ActivatableUIRequiresPower
  - type: UserInterface
    interfaces:
      enum.ProgrammableComputerUiKey.Key:
        type: ProgrammableComputerBUI
  - type: ProgrammableComputerHost
  # Device links
  - type: DeviceNetwork
    deviceNetId: Wireless
    receiveFrequencyId: BasicDevice
  - type: WirelessNetworkConnection
    range: 25
  - type: DeviceLinkSource
    ports:
    - CustomPort1
    - CustomPort2
    - CustomPort3
    - CustomPort4
  - type: DeviceLinkSink
    ports:
    - CustomPort1
    - CustomPort2
    - CustomPort3
    - CustomPort4


# Already assembled
- type: entity
  id: ComputerProgrammableCompleted
  parent: [BaseStructure, ComputerProgrammableBase]
  name: programmable computer
  suffix: assembled
  components:
  - type: WiresPanel # The in-construction version doesn't have it because it conflicts with the screwing step.
  - type: Construction
    graph: ComputerProgrammable
    node: computer
  - type: ContainerFill
    containers:
      cpu: [ComputerCPUBasic]
      memory: [ComputerMemoryBasic]
      storage: [ComputerHardDiskBasic]
  # Powered
  - type: ExtensionCableReceiver
  - type: ApcPowerReceiver
    powerLoad: 5000 # running assembly is power-consuming, you know?
  - type: Battery
    maxCharge: 30000 # Enough to survive a power flicker, but not to stay powered during outage
    startingCharge: 0
  - type: LitOnPowered
  - type: PointLight
    radius: 1.5
    energy: 1.6
    color: green
    castShadows: false

# Mid assembly
- type: entity
  id: ComputerProgrammableAssembly
  parent: ComputerProgrammableBase
  suffix: under construction
  components:
  - type: Construction
    graph: ComputerProgrammable
    node: frameMissingWires
    defaultTarget: computer
